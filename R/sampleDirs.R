# TODO Add working example



#' Sample Directories
#'
#' @author Michael Steinbaugh
#'
#' @param uploadDir bcbio run upload directory.
#'
#' @return Named character vector containing sample directory paths. Function
#'   will abort if no sample directories match.
#' @export
#'
#' @examples
#' \dontrun{
#' uploadDir <- system.file("extdata/bcbio", package = "bcbioRNASeq")
#' sampleDirs(uploadDir)
#' }
sampleDirs <- function(uploadDir) {
    assert_all_are_dirs(uploadDir)
    subdirs <- list.dirs(uploadDir, full.names = TRUE, recursive = FALSE)
    subdirPattern <- paste0(perSampleDirs, collapse = "|") %>%
        paste0("^", ., "$")
    sampleDirs <- list.files(
        path = subdirs,
        pattern = subdirPattern,
        full.names = TRUE,
        recursive = FALSE
    )
    assert_is_non_empty(sampleDirs)
    sampleDirs <- sampleDirs %>%
        dirname() %>%
        sort() %>%
        unique()

    # Ensure removal of nested `projectDir`
    if (any(grepl(projectDirPattern, basename(sampleDirs)))) {
        sampleDirs <- sampleDirs %>%
            .[!grepl(projectDirPattern, basename(.))]
        assert_is_non_empty(sampleDirs)
    }

    # Generate names from file paths and make valid
    names <- basename(sampleDirs) %>%
        make.names(unique = TRUE) %>%
        gsub("\\.", "_", .)
    sampleDirs <- normalizePath(sampleDirs, winslash = "/", mustWork = TRUE)
    names(sampleDirs) <- names

    inform(paste(length(sampleDirs), "samples detected"))

    sampleDirs
}
